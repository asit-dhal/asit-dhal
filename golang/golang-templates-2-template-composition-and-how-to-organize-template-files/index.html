<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Golang Template-2 Template composition - Asit Dhal</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Golang Template-2: Template composition", url: "#_top", children: [
              {title: "template action", url: "#template-action" },
              {title: "block action", url: "#block-action" },
              {title: "How to organize template files ?", url: "#how-to-organize-template-files" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-58305706-1', 'asit-dhal.github.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../golang-slice-and-append/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../golang-slice-and-append/" class="btn btn-xs btn-link">
        Golang slice and append
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../golang-templates-1-introduction/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../golang-templates-1-introduction/" class="btn btn-xs btn-link">
        Golang Templates-1 Introduction
      </a>
    </div>
    
  </div>

    

    <h1 id="golang-template-2-template-composition">Golang Template-2: Template composition</h1>
<p>Golang template library provides certain actions to make an efficient and flexible use of multiple template files.
define action</p>
<pre><code class="golang">{{define &quot;templ_name&quot;}}second template{{end}}
</code></pre>

<p>Here, a template with name “templ_name” is defined.</p>
<pre><code class="golang">// defineActionDemo.go 
package main

import (
    &quot;fmt&quot;
    &quot;html/template&quot;
    &quot;os&quot;
)

var defineDemo = `
{{ define &quot;a&quot; }} Template A {{ end }}
{{define &quot;b&quot;}} Template B {{end}}
`

func main() {
    var err error

    t := template.New(&quot;defineActionDemo&quot;)
    t, err = t.Parse(defineDemo)
    if err != nil {
        fmt.Println(&quot;parsing failed: %s&quot;, err)
    }

    err = t.ExecuteTemplate(os.Stdout, &quot;a&quot;, nil)
    if err != nil {
        fmt.Println(&quot;execution failed: %s&quot;, err)
    }

    fmt.Println()
    err = t.ExecuteTemplate(os.Stdout, &quot;b&quot;, nil)
    if err != nil {
        fmt.Println(&quot;execution failed: %s&quot;, err)
    }
}
</code></pre>

<pre><code>c:\medium\src&gt;go build defineActionDemo.go                                                                                          c:\medium\src&gt;defineActionDemo
Template A                                                                                                                          Template B 
</code></pre>

<p>If there multiple definitions of same template, except one, all other should be empty.</p>
<h2 id="template-action">template action</h2>
<pre><code>{{template &quot;templ_name&quot; }}
{{template &quot;templ_name&quot; pipeline}}
</code></pre>

<p>Here, the template with name “templ_name” will be executed and output will be rendered at the same place.</p>
<p>Output</p>
<pre><code>Template A includes Template B
Template B
Template A ends
</code></pre>

<pre><code class="golang">// templateActionDemo.go 
package main

import (
    &quot;html/template&quot;
    &quot;os&quot;
    &quot;fmt&quot;
)

var templateDemo = 
`
{{ define &quot;a&quot; }} 
Template A includes Template B
{{ template &quot;b&quot; .}}
Template A ends
{{ end }}
{{define &quot;b&quot;}} 
Template B
{{end}}
`

func main() {
    var err error

    t := template.New(&quot;templateActionDemo&quot;)

    t, err = t.Parse(templateDemo)

    if err != nil {
        fmt.Println(&quot;parsing failed: %s&quot;, err)
    }
    err = t.ExecuteTemplate(os.Stdout, &quot;a&quot;, nil)
    if err != nil {
        fmt.Println(&quot;execution failed: %s&quot;, err)
    }

}
</code></pre>

<h2 id="block-action">block action</h2>
<p>Block action is defining a template and executing in place.</p>
<pre><code>{{block &quot;name&quot; pipeline}} huuw {{end}}
</code></pre>

<pre><code class="golang">// blockActionDemo.go
package main

import (
    &quot;fmt&quot;
    &quot;html/template&quot;
    &quot;os&quot;
)

var templateDemo = `
{{ define &quot;a&quot; }} 
Template A includes Template B
{{ block &quot;b&quot; .}} Template B {{ end }}
Template A ends
{{ end }}
`

func main() {
    var err error

    t := template.New(&quot;templateActionDemo&quot;)

    t, err = t.Parse(templateDemo)

    if err != nil {
        fmt.Println(&quot;parsing failed: %s&quot;, err)
    }
    err = t.ExecuteTemplate(os.Stdout, &quot;a&quot;, nil)
    if err != nil {
        fmt.Println(&quot;execution failed: %s&quot;, err)
    }

}
</code></pre>

<p>Output</p>
<pre><code>Template A includes Template B                                         
Template B                                                                                                                         Template A ends 
</code></pre>

<p>All these three actions are very powerful.</p>
<ol>
<li>Template composition(nested template or template embedding or template inheritance) can be achieved.</li>
<li>Empty template can be used as placeholder templates.</li>
</ol>
<h2 id="how-to-organize-template-files">How to organize template files ?</h2>
<p>We keep our template files in two directories. One is the layout and other is the application specific views. The layout will contain base template and other common templates.</p>
<p><img alt="file-structure" src="../images/file-structure.png" /></p>
<p>base.tmpl will contain the skeleton of HTML page for the entire website.</p>
<pre><code class="html">&lt;!-- base.tmpl --&gt;

{{ define &quot;base&quot; }}
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;{{block &quot;title&quot; .}} {{end}}&lt;/title&gt;
    {{block &quot;style&quot; .}} {{end}}
&lt;/head&gt;
&lt;body&gt;
    &lt;body&gt;
        {{template &quot;content&quot; .}}
    &lt;/body&gt;
    &lt;footer&gt;{{block &quot;footer&quot; .}} {{end}}&lt;/footer&gt;
    {{block &quot;js&quot; .}} {{end}}
&lt;/body&gt;
&lt;/html&gt;

{{ end }}
</code></pre>

<pre><code class="html">&lt;!-- js.tmpl --&gt;

{{ define &quot;js&quot; }}
&lt;script type=&quot;javascript&quot;&gt;
    console.log(&quot;a small js&quot;);
&lt;/script&gt;
{{ end }}
</code></pre>

<pre><code class="html">&lt;!-- style.tmpl --&gt;

{{define &quot;style&quot;}}
&lt;style&gt;
body {
    background-color: lightblue;
}

h1 {
    color: navy;
    margin-left: 20px;
}
&lt;/style&gt;
{{end}}
</code></pre>

<p>Now, all other templates which is a view to user. Each of these will be rendered individually.</p>
<pre><code class="html">&lt;!-- aboutme.tmpl --&gt;
{{define &quot;title&quot;}}About Me{{end}}
{{define &quot;content&quot;}}
&lt;h2&gt;This is About me page.&lt;/h2&gt;
&lt;ul&gt;
    &lt;li&gt;My name is {{ .Name }}. &lt;/li&gt;
    &lt;li&gt;My home city is {{ .City }}. &lt;/li&gt;
    &lt;li&gt;My nationaliy is {{ .Nationality }}. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt;&lt;/p&gt;
{{end}}
</code></pre>

<pre><code class="html">&lt;!-- index.tmpl --&gt;
{{define &quot;title&quot;}}Home{{end}}
{{define &quot;content&quot;}}
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;/skillset&quot;&gt;Skillset&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;/aboutme&quot;&gt;About Me&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
{{end}}
</code></pre>

<pre><code class="html">&lt;!-- skillset.tmpl --&gt;

{{define &quot;title&quot;}}Skillset{{end}}
{{define &quot;content&quot;}}
&lt;h3&gt;My Skillset&lt;/h3&gt;
&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;Language&lt;/th&gt;
            &lt;th&gt;Level&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    {{ range . }}
        &lt;tr&gt;
            &lt;td&gt;{{ .Language }}&lt;/td&gt;
            &lt;td&gt;{{ .Level }}&lt;/td&gt;
        &lt;/tr&gt;
    {{ end }}
    &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt; &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt;&lt;/p&gt;
{{end}}
</code></pre>

<p>In Go, we need to do the following.</p>
<pre><code class="golang">//golang

package main

import (
    &quot;fmt&quot;
    &quot;github.com/oxtoacart/bpool&quot;
    &quot;html/template&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;path/filepath&quot;
)

var templates map[string]*template.Template
var bufpool *bpool.BufferPool

type UserData struct {
    Name        string
    City        string
    Nationality string
}

type SkillSet struct {
    Language string
    Level    string
}

type TemplateConfig struct {
    TemplateLayoutPath  string
    TemplateIncludePath string
}

type SkillSets []*SkillSet

var mainTmpl = `{{define &quot;main&quot; }} {{ template &quot;base&quot; . }} {{ end }}`

var templateConfig TemplateConfig

func loadConfiguration() {
    templateConfig.TemplateLayoutPath = &quot;templates/layouts/&quot;
    templateConfig.TemplateIncludePath = &quot;templates/&quot;
}

func loadTemplates() {
    if templates == nil {
        templates = make(map[string]*template.Template)
    }


    layoutFiles, err := filepath.Glob(templateConfig.TemplateLayoutPath + &quot;*.tmpl&quot;)
    if err != nil {
        log.Fatal(err)
    }

    includeFiles, err := filepath.Glob(templateConfig.TemplateIncludePath + &quot;*.tmpl&quot;)
    if err != nil {
        log.Fatal(err)
    }

    mainTemplate := template.New(&quot;main&quot;)

    mainTemplate, err = mainTemplate.Parse(mainTmpl)
    if err != nil {
        log.Fatal(err)
    }
    for _, file := range includeFiles {
        fileName := filepath.Base(file)
        files := append(layoutFiles, file)
        templates[fileName], err = mainTemplate.Clone()
        if err != nil {
            log.Fatal(err)
        }   
        templates[fileName] = template.Must(templates[fileName].ParseFiles(files...))
    }

    log.Println(&quot;templates loading successful&quot;)

    bufpool = bpool.NewBufferPool(64)
    log.Println(&quot;buffer allocation successful&quot;)
}

func renderTemplate(w http.ResponseWriter, name string, data interface{}) {
    tmpl, ok := templates[name]
    if !ok {
        http.Error(w, fmt.Sprintf(&quot;The template %s does not exist.&quot;, name),
            http.StatusInternalServerError)
    }

    buf := bufpool.Get()
    defer bufpool.Put(buf)

    err := tmpl.Execute(buf, data)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }

    w.Header().Set(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)
    buf.WriteTo(w)
}


func index(w http.ResponseWriter, r *http.Request) {
    renderTemplate(w, &quot;index.tmpl&quot;, nil)
}

func aboutMe(w http.ResponseWriter, r *http.Request) {
    userData := &amp;UserData{Name: &quot;Asit Dhal&quot;, City: &quot;Bhubaneswar&quot;, Nationality: &quot;Indian&quot;}
    renderTemplate(w, &quot;aboutme.tmpl&quot;, userData)
}

func skillSet(w http.ResponseWriter, r *http.Request) {
    skillSets := SkillSets{&amp;SkillSet{Language: &quot;Golang&quot;, Level: &quot;Beginner&quot;},
        &amp;SkillSet{Language: &quot;C++&quot;, Level: &quot;Advanced&quot;},
        &amp;SkillSet{Language: &quot;Python&quot;, Level: &quot;Advanced&quot;}}
    renderTemplate(w, &quot;skillset.tmpl&quot;, skillSets)
}

func main() {
    loadConfiguration()
    loadTemplates()
    server := http.Server{
        Addr: &quot;127.0.0.1:8080&quot;,
    }

    http.HandleFunc(&quot;/&quot;, index)
    http.HandleFunc(&quot;/aboutme&quot;, aboutMe)
    http.HandleFunc(&quot;/skillset&quot;, skillSet)
    server.ListenAndServe()
}
</code></pre>

<p>Before the application starts to listen for HTTP request, all template files are loaded. Every time there is a request, the specific template is executed.</p>
<p>Working example: <a href="https://github.com/asit-dhal/golang-template-layout">https://github.com/asit-dhal/golang-template-layout</a>.</p>
<p>Thanks for reading !!</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../golang-slice-and-append/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../golang-slice-and-append/" class="btn btn-xs btn-link">
        Golang slice and append
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../golang-templates-1-introduction/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../golang-templates-1-introduction/" class="btn btn-xs btn-link">
        Golang Templates-1 Introduction
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright &copy; 2017-2019 Asit Dhal</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>