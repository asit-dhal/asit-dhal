



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://asit-dhal.github.io/cmake/custom-command-and-custom-tasks/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Custom Commands and Custom Tasks</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-58305706-1", "asit-dhal.github.io")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#custom-commands-and-custom-targets" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://asit-dhal.github.io/" title="Asit Dhal's Personal Blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Asit Dhal's Personal Blog
            </span>
            <span class="md-header-nav__topic">
              
                Custom Commands and Custom Tasks
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://asit-dhal.github.io/" title="Asit Dhal's Personal Blog" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Asit Dhal's Personal Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Git
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../git/delete-old-branches-in-git/" title="Delete old branches in Git" class="md-nav__link">
      Delete old branches in Git
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Juce
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Juce
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../juce/broadcasters-and-listeners-in-juce/" title="Broadcasters and listeners in JUCE" class="md-nav__link">
      Broadcasters and listeners in JUCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../juce/side-panel-in-juce/" title="Side Panel in JUCE" class="md-nav__link">
      Side Panel in JUCE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      C++
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/string-conversion-benchmark/" title="string conversion benchmark in C++" class="md-nav__link">
      string conversion benchmark in C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/range-generator-algorithms/" title="Range Generator Algorithms" class="md-nav__link">
      Range Generator Algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/property-check-agorithims/" title="Property Check Algorithms" class="md-nav__link">
      Property Check Algorithms
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      CMake
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        CMake
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../functions-and-macros/" title="Cmake Functions and Macros" class="md-nav__link">
      Cmake Functions and Macros
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Custom Commands and Custom Tasks" class="md-nav__link md-nav__link--active">
      Custom Commands and Custom Tasks
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Golang
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-templates-1-introduction/" title="Golang Templates-1 Introduction" class="md-nav__link">
      Golang Templates-1 Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-templates-2-template-composition-and-how-to-organize-template-files/" title="Golang Template-2 Template composition" class="md-nav__link">
      Golang Template-2 Template composition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-slice-and-append/" title="Golang slice and append" class="md-nav__link">
      Golang slice and append
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Qt-Qml
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Qt-Qml
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../qt-qml/positioning-with-anchors/" title="Positioning with Anchors" class="md-nav__link">
      Positioning with Anchors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../archives/" title="Archives" class="md-nav__link">
      Archives
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="custom-commands-and-custom-targets">Custom Commands and Custom Targets<a class="headerlink" href="#custom-commands-and-custom-targets" title="Permanent link">&para;</a></h1>
<p>Sometimes you need to do some tasks before the build or after the build, like </p>
<ul>
<li>runnning protocol buffer compiler to generate stubs before the actual build </li>
<li>running moc on header files</li>
<li>copying the resource files to a predefined path. </li>
</ul>
<p>You can assume these as custom targets and you can write custom commands to do these things. CMake provides <code>add_custom_target</code> and <code>add_custom_command</code> to do these tasks. </p>
<h1 id="cmake-targets">CMake targets<a class="headerlink" href="#cmake-targets" title="Permanent link">&para;</a></h1>
<p>CMake allows three types of targets</p>
<ul>
<li>generates an execuatable(<code>add_executable</code>)</li>
<li>generates a library(<code>add_library</code>)</li>
<li>a custom target(can be anything)</li>
</ul>
<p>CMake generates a dependency graph for every target. If a target depends on another target, cmake makes sure the other targate is generated before.  However, you can always cmake to build a specific target.</p>
<p>Unlike executable and libraries, custom target don't represent a thing.</p>
<h2 id="add_custom_target">add_custom_target<a class="headerlink" href="#add_custom_target" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">targetName</span> <span class="s">[ALL]</span> <span class="s">[command1</span> <span class="s">[args1...]]</span>
                  <span class="s">[COMMAND</span> <span class="s">command2</span> <span class="s">[args2...]</span> <span class="s">...]</span>
                  <span class="s">[DEPENDS</span> <span class="s">depend</span> <span class="s">depend</span> <span class="s">depend</span> <span class="s">...</span> <span class="s">]</span>
                  <span class="s">[BYPRODUCTS</span> <span class="s">[files...]]</span>
                  <span class="s">[WORKING_DIRECTORY</span> <span class="s">dir]</span>
                  <span class="s">[COMMENT</span> <span class="s">comment]</span>
                  <span class="s">[JOB_POOL</span> <span class="s">job_pool]</span>
                  <span class="s">[VERBATIM]</span> <span class="s">[USES_TERMINAL]</span>
                  <span class="s">[COMMAND_EXPAND_LISTS]</span>
                  <span class="s">[SOURCES</span> <span class="s">src1</span> <span class="s">[src2...]]</span><span class="p">)</span>
</pre></div>


<p>targetName is the new target name. You can run the target using the following command.</p>
<div class="codehilite"><pre><span></span>cmake . --build --target targetName
</pre></div>


<p>ALL option makes the ALL target depend on the targetName. By default <code>ALL</code> target is built if nothing is specified. By making ALL depend on this target, we make this target to be built. Otherwise you have to explicitly request a build. Or, it will be built if some other target depends on this. Custom targets are always built(always out of date). So, if some other target depends on this, that other target will always be built.</p>
<p>The next arguments are one or more commands with their arguments. You can skip the COMMAND keyword for the first command. Commands are the good old commands which can be executed. The order is always the order in which it is specified. CMake provides some predefined command which can be usec by <code>${CMAKE_COMMAND} -E</code> (cmake in command mode). <code>${CMAKE_COMMAND}</code> is the cmake command which is used to invoke this project. This way of invoking cmake command makes sure that wrong cmake is not invoked. </p>
<p>It's recommended to use <code>${CMAKE_COMMAND} -E</code> to call cmake provided commands. It's more platform independent.</p>
<div class="codehilite"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">target1</span> <span class="s">ALL</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is command 1&quot;</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is command 2&quot;</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is command 3&quot;</span>
<span class="p">)</span>
</pre></div>


<p>Output</p>
<div class="codehilite"><pre><span></span>This is command 1
This is command 2
This is command 3
</pre></div>


<p><code>DEPENDS</code> argument will take one or more targets. This will always create a target level dependency. These targets will be built before the current target.</p>
<div class="codehilite"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">target1</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is target1&quot;</span>
<span class="p">)</span>

<span class="nb">add_custom_target</span><span class="p">(</span><span class="s">target2</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is target2&quot;</span>
<span class="p">)</span>

<span class="nb">add_custom_target</span><span class="p">(</span><span class="s">target3</span> <span class="s">ALL</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is target3&quot;</span>
    <span class="s">DEPENDS</span> <span class="s">target1</span> <span class="s">target2</span>
<span class="p">)</span>
</pre></div>


<p>Output</p>
<div class="codehilite"><pre><span></span>This is target2
Built target target2
This is target1
Built target target1
This is target3
Built target target3
</pre></div>


<p><code>BYPRODUCTS</code> are the list of files expected to be generated. These are marked as <code>GENERATED</code>. This tells CMake not to check for its existence at configure time, since it gets created as part of the build process. This is useful if you have targe which needs a GENERATED file from another custom target. CMake will not check the existence during configuration phase.</p>
<p><code>WORKING_DIRECTORY</code> is the directory where the commands are generated. If this option is not given, the commands will be run in <code>${CMAKE_CURRENT_BINARY_DIR}</code>.</p>
<p><code>COMMENT</code> is the message which will be shown in the console before the targetName is built.</p>
<p><code>JOB_POOL</code> is optional and I have no clue what it is.</p>
<p><code>SOURCES</code> option has no role in the build process. Any files mentioned here will be shown in the IDE. If you have a custom command which copies some shader files to a specific path, you can add those files in the SOURCES. Then IDE will show the files in the project tree. </p>
<p>Some header only libraries also use custom command to show the header files in the project</p>
<div class="codehilite"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">HEADER_BASE</span> <span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}/external/stringify&quot;</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">GLOB_RECURSE</span> <span class="s">stringify_include_SRCS</span> <span class="s2">&quot;${HEADER_BASE}/*.hpp&quot;</span><span class="p">)</span>
<span class="nb">add_custom_target</span><span class="p">(</span><span class="s">stringify_headers_for_ide</span> <span class="s">SOURCES</span> <span class="o">${</span><span class="nv">stringify_include_SRCS</span><span class="o">}</span><span class="p">)</span>
</pre></div>


<p><code>VERBATIM</code>:</p>
<h3 id="example-1-copy-resource-files-after-build">Example 1: copy resource files after build<a class="headerlink" href="#example-1-copy-resource-files-after-build" title="Permanent link">&para;</a></h3>
<p>I have some vertex and fragment shader, which are in current source directory. </p>
<div class="codehilite"><pre><span></span>.
├── CMakeLists.txt
├── CoordinateSystem.cpp
├── CoordinateSystem.h
├── main.cpp
└── res
    ├── shader.frag
    └── shader.vert
</pre></div>


<p>I need to copy the resource files in res folder to the binary folder.</p>
<div class="codehilite"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">TARGET_NAME</span> <span class="s">coordinate_system</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">TARGET_NAME</span><span class="o">}</span>
  <span class="s">CoordinateSystem.cpp</span>
  <span class="s">main.cpp</span>
<span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">TARGET_NAME</span><span class="o">}</span> <span class="s">PRIVATE</span> <span class="s">opengl-framework</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">RES_FILES</span>
    <span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}/res/shader.frag&quot;</span>
    <span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}/res/shader.vert&quot;</span>
<span class="p">)</span>

<span class="nb">add_custom_target</span><span class="p">(</span><span class="o">${</span><span class="nv">TARGET_NAME</span><span class="o">}</span><span class="s">_copy_resources</span> <span class="s">ALL</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">copy_if_different</span> <span class="o">${</span><span class="nv">RES_FILES</span><span class="o">}</span> <span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span>
    <span class="s">DEPENDS</span> <span class="o">${</span><span class="nv">TARGET_NAME</span><span class="o">}</span>
    <span class="s">COMMENT</span> <span class="s2">&quot;Copying resource files for ${TARGET_NAME}&quot;</span>
    <span class="s">SOURCES</span> <span class="o">${</span><span class="nv">RES_FILES</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>


<p>My custom command depends on the target(technically not :P ). ${CMAKE_COMMAND} is the cmake command which is used to invoke this project. In some projects, there are multiple versions of cmake. This way of invoking cmake command makes sure that wrong cmake is not invoked. -E is the option to invoke some predefined cmake command.
You can get a list of cmake supported commands by --help option.</p>
<div class="codehilite"><pre><span></span>  master ●  cmake -E --help
CMake Error: cmake version 3.13.5
Usage: cmake -E &lt;command&gt; [arguments...]
Available commands: 
  capabilities              - Report capabilities built into cmake in JSON format
  chdir dir cmd [args...]   - run command in a given directory
....
....
blah blah 
</pre></div>


<p>It's recommended to use <code>${CMAKE_COMMAND} -E</code> to call cmake provided commands. It's more platform independent.</p>
<div class="codehilite"><pre><span></span>  master ●  cmake -E --help
CMake Error: cmake version 3.13.5
Usage: cmake -E &lt;command&gt; [arguments...]
Available commands: 
  capabilities              - Report capabilities built into cmake in JSON format
  chdir dir cmd [args...]   - run command in a given directory
  compare_files file1 file2 - check if file1 is same as file2
  copy &lt;file&gt;... destination  - copy files to destination (either file or directory)
  copy_directory &lt;dir&gt;... destination   - copy content of &lt;dir&gt;... directories to &#39;destination&#39; directory
  copy_if_different &lt;file&gt;... destination  - copy files if it has changed
  echo [&lt;string&gt;...]        - displays arguments as text
....
....
blah blah 
</pre></div>


<p>copy_if_different uses the timestamp to check if the source files are changed.</p>
<p>I have added explicit dependency with orginal target. What's point of copying the resource files if the binary build fails ?</p>
<p>COMMENT text will be visible when you run the build.</p>
<p>SOURCES will make the IDE show the resource files.</p>
<p>Here the build log</p>
<div class="codehilite"><pre><span></span>Scanning dependencies of target coordinate_system
[ 88%] Building CXX object example/coordinate_system/CMakeFiles/coordinate_system.dir/CoordinateSystem.cpp.o
[ 92%] Building CXX object example/coordinate_system/CMakeFiles/coordinate_system.dir/main.cpp.o
[ 96%] Linking CXX executable coordinate_system
[ 96%] Built target coordinate_system
Scanning dependencies of target coordinate_system_copy_resources
[100%] Copying resource files for coordinate_system
[100%] Built target coordinate_system_copy_resources
</pre></div>


<p><code>SOURCES</code> will make the IDE show the resource files.</p>
<p><img alt="custome_target_IDE" src="../images/custome_target_IDE.png" /></p>
<h2 id="add_custom_command">add_custom_command<a class="headerlink" href="#add_custom_command" title="Permanent link">&para;</a></h2>
<p>Sometimes a custom target is a little over engineering, e.g. you need to run a small script for each binary generated. Instead you can add the additional rules when the target is built. add_custom_command serves this purpose.</p>
<p>There are two kinds of custom command</p>
<ul>
<li>command to generate files: generates specified OUTPUT file(s)</li>
<li>command which runs on build events</li>
</ul>
<h3 id="generating-files">Generating Files<a class="headerlink" href="#generating-files" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nb">add_custom_command</span><span class="p">(</span><span class="s">OUTPUT</span> <span class="s">output1</span> <span class="s">[output2</span> <span class="s">...]</span>
                   <span class="s">COMMAND</span> <span class="s">command1</span> <span class="s">[ARGS]</span> <span class="s">[args1...]</span>
                   <span class="s">[COMMAND</span> <span class="s">command2</span> <span class="s">[ARGS]</span> <span class="s">[args2...]</span> <span class="s">...]</span>
                   <span class="s">[MAIN_DEPENDENCY</span> <span class="s">depend]</span>
                   <span class="s">[DEPENDS</span> <span class="s">[depends...]]</span>
                   <span class="s">[BYPRODUCTS</span> <span class="s">[files...]]</span>
                   <span class="s">[IMPLICIT_DEPENDS</span> <span class="s">&lt;lang1&gt;</span> <span class="s">depend1</span>
                                    <span class="s">[&lt;lang2&gt;</span> <span class="s">depend2]</span> <span class="s">...]</span>
                   <span class="s">[WORKING_DIRECTORY</span> <span class="s">dir]</span>
                   <span class="s">[COMMENT</span> <span class="s">comment]</span>
                   <span class="s">[DEPFILE</span> <span class="s">depfile]</span>
                   <span class="s">[JOB_POOL</span> <span class="s">job_pool]</span>
                   <span class="s">[VERBATIM]</span> <span class="s">[APPEND]</span> <span class="s">[USES_TERMINAL]</span>
                   <span class="s">[COMMAND_EXPAND_LISTS]</span><span class="p">)</span>
</pre></div>


<p>add_custom_command takes one or more output file names to be given after the OUTPUT keyword. The series of commands will be executed to generate that file. Custom commands are not executed on its own. If some other target  has some dependency on the output file, then the custom command is invoked.</p>
<p>add_custom_command generates file by running a one or more commands after the dependent target has been built. COMMAND, BYPRODUCTS, COMMENT and USES_TERMINAL options behave like add_custom_target.</p>
<p>IMPLICIT_DEPENDS
    Request scanning of implicit dependencies of an input file. The language given specifies the programming language whose corresponding dependency scanner should be used. Currently only C and CXX language scanners are supported. The language has to be specified for every file in the IMPLICIT_DEPENDS list. Dependencies discovered from the scanning are added to those of the custom command at build time. Note that the IMPLICIT_DEPENDS option is currently supported only for Makefile generators and will be ignored by other generators.</p>
<h4 id="depends">DEPENDS<a class="headerlink" href="#depends" title="Permanent link">&para;</a></h4>
<p>If DEPENDS is missing, the custom command will be run when the OUTPUT is missing. If the custom command doesn't create any file, then this will run always.</p>
<p>If any dependency is an OUTPUT of another custom command in the same directory (CMakeLists.txt file) CMake automatically brings the other custom command into the target in which this command is built. </p>
<p>If the DEPENDS is the target of any add_executable, add_library or add_custom_target, a target level dependency is created. </p>
<h2 id="build-events">Build Events<a class="headerlink" href="#build-events" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">&lt;target&gt;</span>
                   <span class="s">PRE_BUILD</span> <span class="s">|</span> <span class="s">PRE_LINK</span> <span class="s">|</span> <span class="s">POST_BUILD</span>
                   <span class="s">COMMAND</span> <span class="s">command1</span> <span class="s">[ARGS]</span> <span class="s">[args1...]</span>
                   <span class="s">[COMMAND</span> <span class="s">command2</span> <span class="s">[ARGS]</span> <span class="s">[args2...]</span> <span class="s">...]</span>
                   <span class="s">[BYPRODUCTS</span> <span class="s">[files...]]</span>
                   <span class="s">[WORKING_DIRECTORY</span> <span class="s">dir]</span>
                   <span class="s">[COMMENT</span> <span class="s">comment]</span>
                   <span class="s">[VERBATIM]</span> <span class="s">[USES_TERMINAL]</span><span class="p">)</span>
</pre></div>


<p>This custom command will add additional rule to existing targets. </p>
<p>The first argument is the target name, it should be specifiec before the command. The target should be created either by <code>add_executable</code>, <code>add_library</code> or <code>add_custom__target</code>.</p>
<p><code>PRE_BUILD</code>, <code>PRE_LINK</code> or <code>POST_BUILD</code> is the time when the command will run. </p>
<p><code>PRE_BUILD</code>:- The command will run before any other rules are executed within the target in case of Visual Studio. In other generators, it will behave like <code>PRE_LINK</code>.</p>
<p><code>PRE_LINK</code>:- The command will run after the compilation and before the linking. It's not supported for custom commands.</p>
<p><code>POST_BUILD</code>:- This will be run after the target is built.</p>
<p>You can add any number of custom commands for a build.</p>
<p>All other options are similar to add_custom_target.</p>
<div class="codehilite"><pre><span></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">main</span> <span class="s">main.cpp</span><span class="p">)</span>

<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">main</span>
                   <span class="s">PRE_BUILD</span>
                   <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is pre build command&quot;</span>
                   <span class="s">COMMENT</span> <span class="s2">&quot;Custom command for pre build&quot;</span>
<span class="p">)</span>

<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">main</span>
                   <span class="s">PRE_LINK</span>
                   <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is pre link command&quot;</span>
                   <span class="s">COMMENT</span> <span class="s2">&quot;Custom command for pre link&quot;</span>
<span class="p">)</span>
<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">main</span>
                   <span class="s">POST_BUILD</span>
                   <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span> <span class="s">-E</span> <span class="s">echo</span> <span class="s2">&quot;This is post build command&quot;</span>
                   <span class="s">COMMENT</span> <span class="s2">&quot;Custom command for post build&quot;</span>
<span class="p">)</span>
</pre></div>


<p>Output</p>
<div class="codehilite"><pre><span></span>Custom command for pre build
This is pre build command
Custom command for pre build 2
This is pre build command 2
Custom command for pre link
This is pre link command
Custom command for post build
This is post build command
[100%] Built target main
</pre></div>


<p>If the target is not rebuilt, custom command won't be executed.</p>
<h3 id="example-">Example:-<a class="headerlink" href="#example-" title="Permanent link">&para;</a></h3>
<p>I have a benchmarking project where I need to execute all binaries and generate report. I want this to be fully integrated into the build system.</p>
<div class="codehilite"><pre><span></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">fill</span> <span class="s">fill.cpp</span><span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">fill</span>
    <span class="s">PRIVATE</span> <span class="s">benchmark::benchmark</span> <span class="s">benchmark::benchmark_main</span>
    <span class="s">PRIVATE</span> <span class="s">meta</span> <span class="s">range-v3</span><span class="p">)</span>

<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">fill</span>
    <span class="s">POST_BUILD</span>
    <span class="s">COMMAND</span> <span class="o">${</span><span class="nv">CMAKE_RUNTIME_OUTPUT_DIRECTORY</span><span class="o">}</span><span class="s">/fill</span> <span class="s2">&quot;--benchmark_format=json&quot;</span> <span class="s">&gt;</span> <span class="o">${</span><span class="nv">BENCHMARK_REPORT_DIRECTORY</span><span class="o">}</span><span class="s">/fill.json</span>
    <span class="s">COMMENT</span> <span class="s2">&quot;Generating report for fill&quot;</span>
<span class="p">)</span>
</pre></div>


<p>Output</p>
<div class="codehilite"><pre><span></span>Scanning dependencies of target fill
[ 12%] Building CXX object CMakeFiles/fill.dir/fill.cpp.o
[ 25%] Linking CXX executable bin/fill
Generating report for fill
</pre></div>


<p>Here after the target fill is built, it will be executed to generate report.</p>
<p><img alt="add_custom_command" src="../images/add_custom_command.png" /></p>
<p>The entire source code can be found here</p>
<p><a href="https://github.com/asit-dhal/range-benchmarks/blob/master/CMakeLists.txt">CMakeLists.txt</a></p>
                
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://asit-dhal.github.io/cmake/custom-command-and-custom-tasks/";
      this.page.identifier =
        "cmake/custom-command-and-custom-tasks/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//asit-dhal.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../functions-and-macros/" title="Cmake Functions and Macros" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cmake Functions and Macros
              </span>
            </div>
          </a>
        
        
          <a href="../../golang/golang-templates-1-introduction/" title="Golang Templates-1 Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Golang Templates-1 Introduction
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2019 Asit Dhal
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/asit-dhal" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>