<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Delete old branches in Git - Asit Dhal</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../juce/broadcasters-and-listeners-in-juce/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../juce/broadcasters-and-listeners-in-juce/" class="btn btn-xs btn-link">
        Broadcasters and listeners in JUCE
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        Home
      </a>
    </div>
    
  </div>

    

    <p>Sometimes there are many branches, accumulated over the years in a git repository. And you need to delete it to save some space or make management of your repository easy.</p>
<p>To get the list of all local branches</p>
<pre><code class="bash">╭─asit@gandua ~/stringify ‹master*›
╰─$ git branch              
  ci-build-script
  dev
* master
  remotes/origin/add-license-1
  remotes/origin/benchmark

</code></pre>

<p>After that, you can iterate over all local branches and get some technical details like branch creation date(age of the branch), last commit date, last commit message etc.</p>
<p>I will try to delete ci-build-script.</p>
<pre><code class="bash">╭─asit@gandua ~/stringify ‹master*›
╰─$ git merge-base ci-build-script master 
e3b47d97284b911baa266853b208f5ea25115e67
</code></pre>

<p>git merge-base tries to find out a good common ancestor. This can be assumed to return the earliest commit id where branch deviates from master branch.</p>
<p>You can use the commit id of the common ancestor to get creation date and the age of the branch.</p>
<pre><code class="bash">╭─asit@gandua ~/stringify ‹master*› 
╰─$ git log — pretty=format:”%ad” — date=short -n 1 e3b47d97284b911baa266853b208f5ea25115e67
2017–09–25
╭─asit@gandua ~/stringify ‹master*› 
╰─$ git log — pretty=format:”%cr” — date=short -n 1 e3b47d97284b911baa266853b208f5ea25115e67
6 months ago
</code></pre>

<p>Similarly, you can use the branch name to get the latest commit date, age of last commit and the subject line of last commit message.</p>
<pre><code class="bash">╭─asit@gandua ~/stringify ‹master*› 
╰─$ git log — pretty=format:”%ad” — date=short -n 1 ci-build-script 
2017–09–26
╭─asit@gandua ~/stringify ‹master*› 
╰─$ git log — pretty=format:”%cr” — date=short -n 1 ci-build-script
5 months ago
╭─asit@gandua ~/stringify  ‹master*› 
╰─$ git log --pretty=format:&quot;%s&quot; -n 1 ci-build-script              
gcc tnd clang config for travis
</code></pre>

<p>From that you can make an intelligent guess, should you delete the branch or not. The branch ci-build-script was created 5 months ago and last committed 5 months ago. The commit message was “gcc and clang config for travis”.</p>
<p>You can delete it</p>
<pre><code class="bash">git branch -d ci-build-script
</code></pre>

<p>-d option won’t allow you delete unless it is merged. In some cases branch were never merged. So, you can use -D option</p>
<p>You can wrap all the above and make a script.</p>
<pre><code class="bash">#!/bin/bash
#
# Copyright(c) 2018 Asit Dhal.
# Distributed under the MIT License (http://opensource.org/licenses/MIT)
#

LIGHT_BLUE='\033[1;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color
INTERACTIVE=&quot;&quot;
FORCE_DELETE=&quot;&quot;
MASTER=&quot;master&quot;
while [[ $# -gt 0 ]]
do
  key=&quot;$1&quot;
  case $key in
    -f)
    FORCE_DELETE=&quot;y&quot;
    shift
    ;;
    -i)
    INTERACTIVE=&quot;i&quot;
    shift
    ;;
    -fi|-if)
    INTERACTIVE=&quot;i&quot;
    FORCE_DELETE=&quot;y&quot;
    shift
    ;;
    -h)
    echo &quot;$(basename $0) -i Intecative deletion of local branches&quot;
    echo &quot;$(basename $0) -f Force delete the branch(es)&quot;
    echo &quot;$(basename $0)    List local branches with creation and last update date&quot;
    exit
    ;;
    *)
    shift
  esac
done

current_branch=$(git branch | grep &quot;*&quot;)
current_branch=${current_branch/* /}

if [ &quot;${current_branch}&quot; != &quot;${MASTER}&quot; ]; then
  printf &quot;Please change the current branch to ${LIGHT_BLUE}${MASTER}${NC}\n&quot;
  exit
fi

if ! git diff-files --quiet; then 
  printf &quot;you have unstaged changes. $(basename $0) needs a clean working index\n&quot;
  git diff-files --name-status
  printf &quot;Please commit or stash them.\n&quot;
  exit
fi

if ! git diff-index --cached --quiet HEAD; then
  printf &quot;your index contains uncommitted changes. $(basename $0) needs a clean working index\n&quot;
  git diff-index --cached --name-status HEAD
  printf &quot;Please commit or stash them.\n&quot;
  exit  
fi

for brnch in $(git branch | sed /\*/d); do
  created_commit_id=$(git merge-base ${brnch} ${MASTER})
  created_date=$(git log --pretty=format:&quot;%ad&quot; --date=short -n 1 ${created_commit_id})
  created_ago=$(git log --pretty=format:&quot;%cr&quot; --date=short -n 1 ${created_commit_id})
  last_updated_date=$(git log --pretty=format:&quot;%ad&quot; --date=short -n 1 ${brnch})
  updated_before=$(git log --pretty=format:&quot;%cr&quot; --date=short -n 1 ${brnch})
  commit_message_subject=$(git log --pretty=format:'%s' -n 1 ${brnch})
  printf &quot;Branch name         : ${brnch} \n&quot;
  printf &quot;Created on          : ${created_date}${RED}(${created_ago})${NC}\n&quot;
  printf &quot;Last updated on     : ${last_updated_date}${RED}(${updated_before}${NC})\n&quot;
  printf &quot;Last commit message : ${commit_message_subject}\n&quot;
  if [ &quot;${INTERACTIVE}&quot; == &quot;i&quot; ]; then
    printf &quot;${LIGHT_BLUE}Delete the branch, followed by [y/n]?${NC} &quot;
    read ip
    if [ &quot;$ip&quot; == &quot;y&quot; ]; then
      if [ &quot;${FORCE_DELETE}&quot; == &quot;y&quot; ]; then
        git branch -D ${brnch}
      else
        git branch -d ${brnch}
        if [ $? -ne 0 ]; then
          printf &quot;${LIGHT_BLUE}Run with -fi command to delete ${brnch}${NC}\n&quot;
        fi
      fi
    fi
  fi
done
</code></pre>

<p>The script has 2 options: -i and -f-.</p>
<p>If the run the script without any options, it will give you list of all local branches and the above information.</p>
<pre><code class="bash">╰─$ git-clean-local-branches 
Branch name : ci-build-script 
Created on : 2017–09–25(6 months ago)
Last updated on : 2017–09–26(5 months ago)
Last commit message : gcc tnd clang config for travis
Branch name : dev 
Created on : 2017–10–14(5 months ago)
Last updated on : 2017–11–25(4 months ago)
Last commit message : stringify improvement, size and type name removal
Branch name : remotes/origin/add-license-1 
Created on : 2017–10–14(5 months ago)
Last updated on : 2017–10–14(5 months ago)
Last commit message : Create LICENSE
Branch name : remotes/origin/benchmark 
Created on : 2017–10–06(5 months ago)
Last updated on : 2017–10–16(5 months ago)
Last commit message : cxx-pretty print integration
</code></pre>

<p>-i option allows you interactive deletion. -f option uses git delete -D(force delete).</p>
<pre><code class="bash">╭─asit@gandua ~/stringify ‹master*› 
╰─$ git-clean-local-branches -fi
Branch name : ci-build-script 
Created on : 2017–09–25(6 months ago)
Last updated on : 2017–09–26(5 months ago)
Last commit message : gcc tnd clang config for travis
Delete the branch, followed by [y/n]? y
Deleted branch ci-build-script (was 2cb728c).
Branch name : dev 
Created on : 2017–10–14(5 months ago)
Last updated on : 2017–11–25(4 months ago)
Last commit message : stringify improvement, size and type name removal
Delete the branch, followed by [y/n]? y
Deleted branch dev (was f8698b4).
</code></pre>

<p>Thanks for reading.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../juce/broadcasters-and-listeners-in-juce/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../juce/broadcasters-and-listeners-in-juce/" class="btn btn-xs btn-link">
        Broadcasters and listeners in JUCE
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        Home
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright &copy; 2017 Asit Dhal</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>