



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Broadcasters and listeners in JUCE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-58305706-1", "asit-dhal.github.io")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#broadcasters-and-listeners-in-juce" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Asit Dhal" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Asit Dhal
            </span>
            <span class="md-header-nav__topic">
              
                Broadcasters and listeners in JUCE
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Asit Dhal" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Asit Dhal
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../archives/" title="Archives" class="md-nav__link">
      Archives
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Git
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../git/delete-old-branches-in-git/" title="Delete old branches in Git" class="md-nav__link">
      Delete old branches in Git
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Juce
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Juce
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Broadcasters and listeners in JUCE
      </label>
    
    <a href="./" title="Broadcasters and listeners in JUCE" class="md-nav__link md-nav__link--active">
      Broadcasters and listeners in JUCE
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#broadcasters-and-listeners-in-juce" title="Broadcasters and listeners in JUCE" class="md-nav__link">
    Broadcasters and listeners in JUCE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listeners" title="Listeners" class="md-nav__link">
    Listeners
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-provided-listener" title="User provided Listener" class="md-nav__link">
    User provided Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../side-panel-in-juce/" title="Side Panel in JUCE" class="md-nav__link">
      Side Panel in JUCE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      C++
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/string-conversion-benchmark/" title="string conversion benchmark in C++" class="md-nav__link">
      string conversion benchmark in C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/range-generator-algorithms/" title="Range Generator Algorithms" class="md-nav__link">
      Range Generator Algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/property-check-agorithims/" title="Property Check Algorithms" class="md-nav__link">
      Property Check Algorithms
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Golang
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-templates-1-introduction/" title="Golang Templates-1 Introduction" class="md-nav__link">
      Golang Templates-1 Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-templates-2-template-composition-and-how-to-organize-template-files/" title="Golang Template-2 Template composition" class="md-nav__link">
      Golang Template-2 Template composition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../golang/golang-slice-and-append/" title="Golang slice and append" class="md-nav__link">
      Golang slice and append
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#broadcasters-and-listeners-in-juce" title="Broadcasters and listeners in JUCE" class="md-nav__link">
    Broadcasters and listeners in JUCE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listeners" title="Listeners" class="md-nav__link">
    Listeners
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-provided-listener" title="User provided Listener" class="md-nav__link">
    User provided Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Broadcasters and listeners in JUCE</h1>
                
                <h2 id="broadcasters-and-listeners-in-juce">Broadcasters and listeners in JUCE</h2>
<p>Juce uses broadcasters and listeners pattern to propagate state changes. This is like classical observer pattern. Broadcasters are subjects and listeners are observers. Juce Framework provides predefined library to automate this process.</p>
<p>Let’s say we have a Window with a slider and a label. When the user changes the slider position, the label will show the value.</p>
<pre><code class="cpp">// MainComponent.h
#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;

class MainComponent   : public Component
{
public:
    MainComponent();
    ~MainComponent();

    void paint (Graphics&amp;) override;
    void resized() override;

private:
    Slider m_valueSlider;
    Label m_sliderLabel;

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainComponent)
};
</code></pre>

<pre><code class="cpp">// MainComponent.cpp

#include &quot;MainComponent.h&quot;

MainComponent::MainComponent()
{
    addAndMakeVisible(m_valueSlider);
    m_valueSlider.setRange(10, 100); 
    m_valueSlider.setTextValueSuffix(&quot; Cnt&quot;);
    m_valueSlider.setTextBoxStyle(Slider::TextEntryBoxPosition::NoTextBox, false, 0, 0);

    addAndMakeVisible(m_sliderLabel);
    m_sliderLabel.setText(&quot;Value&quot;, dontSendNotification);
    setSize (600, 400);
}

MainComponent::~MainComponent()
{
}

void MainComponent::paint (Graphics&amp; g)
{
    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));

    g.setFont (Font (16.0f));
    g.setColour (Colours::white);
}

void MainComponent::resized()
{
    auto sliderLeft = 120;
    m_valueSlider.setBounds(sliderLeft, 20, getWidth() - sliderLeft - 10, 20);
    m_sliderLabel.setBounds(sliderLeft, 50, getWidth() - sliderLeft - 10, 20);
}
</code></pre>

<p>At this moment both the slider and the label don’t interact with each other.</p>
<p>We are going to show the value of slider in the label.</p>
<h3 id="listeners">Listeners</h3>
<p>Most Juce components have an inner class called Listener.</p>
<ul>
<li>
<p>This class is an abstract class with at least one pure virtual function. An observer has to inherit from this abstract class and implement the pure virtual function(s). This pure virtual function is the callback.</p>
</li>
<li>
<p>one member function called void addListener(Listener* listener). Using this function, an observer can register it self.</p>
</li>
<li>
<p>another member function called void removeListener(Listener* listener). This one removes the previously registered listener.</p>
</li>
<li>
<p>Whenever a listener is registered, the address is stored in a ListenerList container.</p>
</li>
<li>
<p>Whenever the state changes, the broadcaster iterates over all the registered listeners and calls the appropriate callback.</p>
</li>
</ul>
<p><img alt="Class Diagram of Broadcaster-Listener" src="../images/class-diagram-of-broadcaster-listener.png" /></p>
<p>Slider::Listener provides <code>Slider::Listener::sliderValueChanged( Slider *slide)</code>. We can override that function in the MainComponent. Then register the main component as a listener. In the implementation of sliderValueChanged, we can set the value of the slider in the label.</p>
<pre><code class="cpp">//MainComponent.h 
#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;

class MainComponent   : public Component,
    public Slider::Listener // step 1: inherit the listener abstract class
{
public:
    MainComponent();
    ~MainComponent();

    void paint (Graphics&amp;) override;
    void resized() override;

    // step 2: implementation of pure virtual function 
    void sliderValueChanged(Slider *slider) override;

private:
    Slider m_valueSlider;
    Label m_sliderLabel;

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainComponent)
};
</code></pre>

<pre><code class="cpp">//MainComponent.cpp
#include &quot;MainComponent.h&quot;

MainComponent::MainComponent()
{
    addAndMakeVisible(m_valueSlider);
    m_valueSlider.setRange(10, 100); 
    m_valueSlider.setTextValueSuffix(&quot; Cnt&quot;);
    m_valueSlider.setTextBoxStyle(Slider::TextEntryBoxPosition::NoTextBox, false, 0, 0);

    addAndMakeVisible(m_sliderLabel);
    m_sliderLabel.setText(&quot;Value&quot;, dontSendNotification);
    setSize (600, 400);

    // step 3: register the listener
    m_valueSlider.addListener(this);
}

MainComponent::~MainComponent()
{
    // step 5: unregister the listener
    m_valueSlider.removeListener(this);
}

void MainComponent::paint (Graphics&amp; g)
{
    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));

    g.setFont (Font (16.0f));
    g.setColour (Colours::white);
}

void MainComponent::resized()
{
    auto sliderLeft = 120;
    m_valueSlider.setBounds(sliderLeft, 20, getWidth() - sliderLeft - 10, 20);
    m_sliderLabel.setBounds(sliderLeft, 50, getWidth() - sliderLeft - 10, 20);
}

void MainComponent::sliderValueChanged(Slider *slider)
{
    // step 4: when the value changes, do whatever you want to do.
    if (&amp;m_valueSlider == slider) {
        auto value = slider-&gt;getValue();
        m_sliderLabel.setText(String(std::to_string(static_cast&lt;int&gt;(value))), dontSendNotification);
    }
}
</code></pre>

<p>The broadcaster and listener can have a many to many relationship. One callback can be invoked by many broadcaster. So, you need to know which instanced invoked it. So we do the address comparison in line 44(In this case, it’s not necessary, because we have only one broadcaster.).</p>
<p><img alt="Broadcaster-Listener Demo" src="../images/broadcaste-listener-demo.png" /></p>
<h3 id="user-provided-listener">User provided Listener</h3>
<p>You can also provide your own Listener interface.</p>
<p>Let’s say you have a login form. It has two input boxes, one submit button and one clear button. Clear button is activated when at least one input box has some text and Submit button is activated if both are filled with some data.</p>
<p>We separate the username and password input control to a separate component, called InputForm. In the main component, we have the InputForm and bothe the buttons.</p>
<pre><code class="cpp">// InputForm.h

#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;

class InputForm  : public Component
{
public:
    InputForm();
    ~InputForm();


    void paint (Graphics&amp;) override;
    void resized() override;
    void submit();
    void clear();

private:
    Label m_usernameLabel;
    Label m_passwordLabel;
    Label m_usernameInput;
    Label m_passwordInput;

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (InputForm)
};
</code></pre>

<pre><code class="cpp">// InputForm.cpp

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;
#include &quot;InputForm.h&quot;

InputForm::InputForm()
{
    addAndMakeVisible(m_usernameLabel);
    m_usernameLabel.setText(&quot;Username:&quot;, dontSendNotification);
    m_usernameLabel.attachToComponent(&amp;m_usernameInput, true);
    m_usernameLabel.setColour(Label::textColourId, Colours::orange);
    m_usernameLabel.setJustificationType(Justification::right);

    addAndMakeVisible(m_passwordLabel);
    m_passwordLabel.setText(&quot;Password:&quot;, dontSendNotification);
    m_passwordLabel.attachToComponent(&amp;m_passwordInput, true);
    m_passwordLabel.setColour(Label::textColourId, Colours::orange);
    m_passwordLabel.setJustificationType(Justification::right);

    addAndMakeVisible(m_usernameInput);
    m_usernameInput.setEditable(true);
    m_usernameInput.setColour(Label::backgroundColourId, Colours::darkblue);
    m_usernameInput.setJustificationType(Justification::left);

    addAndMakeVisible(m_passwordInput);
    m_passwordInput.setEditable(true);
    m_passwordInput.setColour(Label::backgroundColourId, Colours::darkblue);
    m_passwordInput.setJustificationType(Justification::left);
}

InputForm::~InputForm()
{
}

void InputForm::paint (Graphics&amp; g)
{

    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));   // clear the background

    g.setColour (Colours::grey);
    g.drawRect (getLocalBounds(), 1);

}

void InputForm::resized()
{
    auto marginX = 10;
    auto marginY = 10;
    auto localBounds = getLocalBounds();

    auto usernameRect = localBounds.removeFromTop(50);
    m_usernameLabel.setBounds(usernameRect.removeFromLeft(usernameRect.getWidth() / 5).reduced(marginX, marginY));
    m_usernameInput.setBounds(usernameRect.reduced(marginX, marginY));

    auto passwordRect = localBounds.removeFromTop(50);
    m_passwordLabel.setBounds(passwordRect.removeFromLeft(passwordRect.getWidth() / 5).reduced(marginX));
    m_passwordInput.setBounds(passwordRect.reduced(marginX, marginY));
}
</code></pre>

<pre><code class="cpp">// MainComponent.h

#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;
#include &quot;InputForm.h&quot;

class MainComponent   : public Component
{
public:
    MainComponent();
    ~MainComponent();

    void paint (Graphics&amp;) override;
    void resized() override;

private:
    InputForm m_inputForm;
    TextButton m_clearButton;
    TextButton m_submitButton;
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainComponent)
};
</code></pre>

<pre><code class="cpp">// MainComponent.cpp

#include &quot;MainComponent.h&quot;

MainComponent::MainComponent()
{
    addAndMakeVisible(m_inputForm);
    addAndMakeVisible(m_clearButton);
    addAndMakeVisible(m_submitButton);

    m_clearButton.setButtonText(&quot;Clear&quot;);
    m_submitButton.setButtonText(&quot;Submit&quot;);

    setSize (600, 400);
}

MainComponent::~MainComponent()
{
}

void MainComponent::paint (Graphics&amp; g)
{
    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));

    g.setFont (Font (16.0f));
    g.setColour (Colours::white);
}

void MainComponent::resized()
{
    auto localBounds = getLocalBounds();
    auto buttonArea = localBounds.removeFromBottom(50);

    m_clearButton.setBounds(buttonArea.removeFromLeft(buttonArea.getWidth() / 2).reduced(10));
    m_submitButton.setBounds(buttonArea.reduced(10));

    m_inputForm.setBounds(localBounds.reduced(10, 10));
}
</code></pre>

<p>We can add a listener interface to the InputForm. It will have to callbacks</p>
<ul>
<li><code>clearActivated()</code></li>
<li><code>submitActivated()</code></li>
</ul>
<p>InputForm must maintain a list of interested listeners and should provide api call for registration and de-registration.</p>
<pre><code class="cpp">// InputForm.h

#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;

class InputForm  : public Component
{
public:
    // other code
    class Listener
    {
    public:
        virtual ~Listener() = default;
        virtual void clearActivated(InputForm*, bool isActive) = 0;
        virtual void submitActivated(InputForm*, bool isActive) = 0;
    };

    void addListener(Listener* listenerToAdd);
    void removeListener(Listener* listenerToRemove);

    // ...
private:
    void clearActivate(bool isActive);
    void submitActivate(bool isActive);

    // ...
    bool m_clearActive;
    bool m_submitActive;
    ListenerList&lt;Listener&gt; m_listeners;
    // ....
};
</code></pre>

<pre><code class="cpp">// InputForm.cpp

InputForm::InputForm()
{
    // ...
    m_clearActive = false;
    m_submitActive = false;
}

void InputForm::addListener(Listener* listenerToAdd)
{
    m_listeners.add(listenerToAdd);
}

void InputForm::removeListener(Listener* listenerToRemove)
{
    jassert(m_listeners.contains(listenerToRemove));
    m_listeners.remove(listenerToRemove);
}

void InputForm::clearActivate(bool isActive)
{
    m_listeners.call([this, isActive](Listener&amp; l) { l.clearActivated(this, isActive); });
}

void InputForm::submitActivate(bool isActive)
{
    m_listeners.call([this, isActive](Listener&amp; l) { l.submitActivated(this, isActive); });
}

</code></pre>

<p>Juce ListenerList<T> class should be used to store the list of listeners. It has many advantages than the std lists, like</p>
<ol>
<li>
<p>add or remove listeners from the list during one of the callbacks — i.e. while it’s in the middle of iterating the listeners, then it’s guaranteed that no listeners will be mistakenly called after they’ve been removed, but it may mean that some of the listeners could be called more than once, or not at all, depending on the list’s order.</p>
</li>
<li>
<p>It has a bailout checker(Component::BailOutChecker class) which checks if the component has already been deleted. This provides safety guarantee that no callback will be called on a deleted component.</p>
</li>
<li>
<p>ListenerList checks if the listener is already in the list or not. So, double addition won’t have any effect.</p>
</li>
</ol>
<p>Now, after implementing input and clear logic, the InputForm control looks like this.</p>
<pre><code class="cpp">// InputForm.h

#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;

class InputForm  : public Component,
    public Label::Listener
{
public:
    InputForm();
    ~InputForm();

    class Listener
    {
    public:
        virtual ~Listener() = default;
        virtual void clearActivated(InputForm*, bool isActive) = 0;
        virtual void submitActivated(InputForm*, bool isActive) = 0;
    };

    void addListener(Listener* listenerToAdd);
    void removeListener(Listener* listenerToRemove);

    void paint (Graphics&amp;) override;
    void resized() override;

    void labelTextChanged(Label *labelThatHasChanged) override;

    void submit();
    void clear();

private:
    void clearActivate(bool isActive);
    void submitActivate(bool isActive);

    Label m_usernameLabel;
    Label m_passwordLabel;
    Label m_usernameInput;
    Label m_passwordInput;

    bool m_clearActive;
    bool m_submitActive;
    ListenerList&lt;Listener&gt; m_listeners;

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (InputForm)
};
</code></pre>

<pre><code class="cpp">// InputForm.cpp

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;
#include &quot;InputForm.h&quot;

InputForm::InputForm()
{
    addAndMakeVisible(m_usernameLabel);
    m_usernameLabel.setText(&quot;Username:&quot;, dontSendNotification);
    m_usernameLabel.attachToComponent(&amp;m_usernameInput, true);
    m_usernameLabel.setColour(Label::textColourId, Colours::orange);
    m_usernameLabel.setJustificationType(Justification::right);

    addAndMakeVisible(m_passwordLabel);
    m_passwordLabel.setText(&quot;Password:&quot;, dontSendNotification);
    m_passwordLabel.attachToComponent(&amp;m_passwordInput, true);
    m_passwordLabel.setColour(Label::textColourId, Colours::orange);
    m_passwordLabel.setJustificationType(Justification::right);

    addAndMakeVisible(m_usernameInput);
    m_usernameInput.setEditable(true);
    m_usernameInput.setColour(Label::backgroundColourId, Colours::darkblue);
    m_usernameInput.setJustificationType(Justification::left);

    addAndMakeVisible(m_passwordInput);
    m_passwordInput.setEditable(true);
    m_passwordInput.setColour(Label::backgroundColourId, Colours::darkblue);
    m_passwordInput.setJustificationType(Justification::left);

    m_clearActive = false;
    m_submitActive = false;

    m_usernameInput.addListener(this);
    m_passwordInput.addListener(this);
}

InputForm::~InputForm()
{
    m_usernameInput.removeListener(this);
    m_passwordInput.removeListener(this);
}

void InputForm::paint (Graphics&amp; g)
{

    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));   // clear the background

    g.setColour (Colours::grey);
    g.drawRect (getLocalBounds(), 1);

}

void InputForm::resized()
{
    auto marginX = 10;
    auto marginY = 10;
    auto localBounds = getLocalBounds();

    auto usernameRect = localBounds.removeFromTop(50);
    m_usernameLabel.setBounds(usernameRect.removeFromLeft(usernameRect.getWidth() / 5).reduced(marginX, marginY));
    m_usernameInput.setBounds(usernameRect.reduced(marginX, marginY));

    auto passwordRect = localBounds.removeFromTop(50);
    m_passwordLabel.setBounds(passwordRect.removeFromLeft(passwordRect.getWidth() / 5).reduced(marginX));
    m_passwordInput.setBounds(passwordRect.reduced(marginX, marginY));
}


void InputForm::addListener(Listener* listenerToAdd)
{
    m_listeners.add(listenerToAdd);
}

void InputForm::removeListener(Listener* listenerToRemove)
{
    jassert(m_listeners.contains(listenerToRemove));
    m_listeners.remove(listenerToRemove);
}

void InputForm::clearActivate(bool isActive)
{
    m_listeners.call([this, isActive](Listener&amp; l) { l.clearActivated(this, isActive); });
}

void InputForm::submitActivate(bool isActive)
{
    m_listeners.call([this, isActive](Listener&amp; l) { l.submitActivated(this, isActive); });
}

void InputForm::labelTextChanged(Label *labelThatHasChanged)
{
    bool atLeastOneTextFilled = false;

    if (labelThatHasChanged == &amp;m_usernameInput) {
        atLeastOneTextFilled = !m_usernameInput.getText(false).isEmpty();
    }
    else if (labelThatHasChanged == &amp;m_passwordInput) {
        atLeastOneTextFilled = !m_passwordInput.getText(false).isEmpty();
    }

    if (!m_clearActive &amp;&amp; atLeastOneTextFilled) {
        m_clearActive = true;
        clearActivate(true);
    }
    else if (m_clearActive &amp;&amp; !atLeastOneTextFilled) {
        m_clearActive = false;
        clearActivate(false);
    }

    bool allTextFilled = !m_usernameInput.getText(true).isEmpty() &amp;&amp; !m_passwordInput.getText(true).isEmpty();
    if (!m_submitActive &amp;&amp; allTextFilled) {
        m_submitActive = true;
        submitActivate(true);
    }
    else if (m_submitActive &amp;&amp; !allTextFilled) {
        m_submitActive = false;
        submitActivate(false);
    }
}

void InputForm::submit()
{
    // do nothing
}
void InputForm::clear()
{
    m_usernameInput.setText(&quot;&quot;, NotificationType::sendNotification);
    m_passwordInput.setText(&quot;&quot;, NotificationType::sendNotification);
}
</code></pre>

<p>When you clear the label programmatically, you need to set the NotificationType. In this case, once the input texts are cleared, we need the callbacks to be called to set the submit and active status. So, we use NotificationType as sendNotification.</p>
<p>In the main component, we implement the InputForm::Listener interface and accordingly set the enabled/disabled status of the buttons.</p>
<pre><code class="cpp">// MainComponent.h

#pragma once

#include &quot;../JuceLibraryCode/JuceHeader.h&quot;
#include &quot;InputForm.h&quot;

class MainComponent   : public Component,
    public InputForm::Listener
{
public:
    MainComponent();
    ~MainComponent();

    void paint (Graphics&amp;) override;
    void resized() override;

    void clearActivated(InputForm*, bool isActive) override;
    void submitActivated(InputForm*, bool isActive) override;

private:
    InputForm m_inputForm;
    TextButton m_clearButton;
    TextButton m_submitButton;
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainComponent)
};

{% endhighlight %}

{% highlight cpp %}

// MainComponent.cpp

#include &quot;MainComponent.h&quot;

MainComponent::MainComponent()
{
    addAndMakeVisible(m_inputForm);
    addAndMakeVisible(m_clearButton);
    addAndMakeVisible(m_submitButton);

    m_clearButton.setButtonText(&quot;Clear&quot;);
    m_submitButton.setButtonText(&quot;Submit&quot;);
    m_clearButton.setEnabled(false);
    m_submitButton.setEnabled(false);

    m_inputForm.addListener(this);

    m_clearButton.onClick = [this] {m_inputForm.clear(); };
    m_submitButton.onClick = [this] {m_inputForm.submit(); };

    setSize (600, 400);
}

MainComponent::~MainComponent()
{
    m_inputForm.removeListener(this);
}

void MainComponent::paint (Graphics&amp; g)
{
    g.fillAll (getLookAndFeel().findColour (ResizableWindow::backgroundColourId));

    g.setFont (Font (16.0f));
    g.setColour (Colours::white);
}

void MainComponent::resized()
{
    auto localBounds = getLocalBounds();
    auto buttonArea = localBounds.removeFromBottom(50);

    m_clearButton.setBounds(buttonArea.removeFromLeft(buttonArea.getWidth() / 2).reduced(10));
    m_submitButton.setBounds(buttonArea.reduced(10));

    m_inputForm.setBounds(localBounds.reduced(10, 10));
}

void MainComponent::clearActivated(InputForm*, bool isActive)
{
    m_clearButton.setEnabled(isActive);
}

void MainComponent::submitActivated(InputForm*, bool isActive)
{
    m_submitButton.setEnabled(isActive);
}
</code></pre>

<p>The application finally looks like this</p>
<p><img alt="Broadcast-Listener Demo" src="../images/broadcaste-listener-demo-final.png" /></p>
<p>Comparison with Qt Signal/Slots</p>
<ol>
<li>
<p>Callbacks are like Slots in Qt. Qt MOC does all the major work of adding code for callback handling. There is no MOC here, so developer has to write everything.</p>
</li>
<li>
<p>In Qt, signal emitters are completely decoupled from signal receivers. So, if you want to add a new signal, it needs minimum amount of code change. In Juce, you will need at least one pure virtual function, code for listener registration and removal.</p>
</li>
<li>
<p>Both Qt and Juce provide asynchronous call by using Qt Event loop and Juce AsyncUpdater respectively. But Juce needs some protection from race condition.</p>
</li>
</ol>
<p>I wrote this blog to clarify my doubts. Feel free to correct if I am wrong or write a comment if you want to suggest something.</p>
<p>The source code is shared here</p>
<p><a href="https://github.com/asit-dhal/Broadcaster-Listener-Demo">https://github.com/asit-dhal/Broadcaster-Listener-Demo</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../git/delete-old-branches-in-git/" title="Delete old branches in Git" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Delete old branches in Git
              </span>
            </div>
          </a>
        
        
          <a href="../side-panel-in-juce/" title="Side Panel in JUCE" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Side Panel in JUCE
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2019 Asit Dhal
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>